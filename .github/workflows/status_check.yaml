name: Pass Status Check

on:
  workflow_call:

jobs:
  status_check:
    runs-on: ubuntu-latest
    name: Creates status check for scheduled deployments
    steps:
      - uses: actions/checkout@v3
      - name: Create status check
        continue-on-error: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
          RUN_ID: ${{ github.run_id }}
        if: github.event_name == 'schedule'
        run: |
          DEPLOY_COMMIT=$(git rev-parse HEAD)
          gh api \
            --method POST \
            -H "Accept: application/vnd.github.v3+json" \
            /repos/$REPO/statuses/$DEPLOY_COMMIT \
            -f state="success" \
            -f target_url="https://github.com/$REPO/actions/runs/$RUN_ID" \
            -f description="The latest scheduled deploy succeeded" \
            -f context="scheduled-deploy"
